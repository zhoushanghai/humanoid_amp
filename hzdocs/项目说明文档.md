# Humanoid AMP é¡¹ç›®è¯´æ˜æ–‡æ¡£

> **é¡¹ç›®æ¦‚è¿°**: åŸºäº Isaac Lab çš„äººå½¢æœºå™¨äºº AMP (Adversarial Motion Prior) å¼ºåŒ–å­¦ä¹ è®­ç»ƒæ¡†æ¶ï¼Œæ”¯æŒ Unitree G1 æœºå™¨äººçš„è¡Œèµ°å’Œèˆè¹ˆåŠ¨ä½œæ¨¡ä»¿å­¦ä¹ ã€‚

---

## ğŸ“¦ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ |
|------|---------|
| Isaac Sim | 5.0.0 |
| Isaac Lab | 2.2.0 |
| Python | 3.10 |
| skrl | â‰¥1.4.3 |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
humanoid_amp/
â”œâ”€â”€ __init__.py              # Gymç¯å¢ƒæ³¨å†Œå…¥å£
â”œâ”€â”€ train.py                 # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ play.py                  # è¯„ä¼°/æ¨ç†è„šæœ¬
â”œâ”€â”€ g1_amp_env.py            # G1æœºå™¨äººAMPç¯å¢ƒå®ç°
â”œâ”€â”€ g1_amp_env_cfg.py        # G1ç¯å¢ƒé…ç½®
â”œâ”€â”€ g1_cfg.py                # G1æœºå™¨äººArticulationé…ç½®
â”œâ”€â”€ humanoid_amp_env.py      # é€šç”¨äººå½¢AMPç¯å¢ƒå®ç°
â”œâ”€â”€ humanoid_amp_env_cfg.py  # é€šç”¨äººå½¢ç¯å¢ƒé…ç½®
â”œâ”€â”€ agents/                  # SKRLè®­ç»ƒé…ç½®
â”‚   â”œâ”€â”€ skrl_g1_walk_amp_cfg.yaml
â”‚   â”œâ”€â”€ skrl_g1_dance_amp_cfg.yaml
â”‚   â””â”€â”€ ...
â”œâ”€â”€ motions/                 # åŠ¨ä½œæ•°æ®ä¸å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ G1_walk.npz         # G1è¡Œèµ°åŠ¨ä½œæ•°æ®
â”‚   â”œâ”€â”€ G1_dance.npz        # G1èˆè¹ˆåŠ¨ä½œæ•°æ®
â”‚   â”œâ”€â”€ motion_loader.py    # åŠ¨ä½œæ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ motion_viewer.py    # 3DåŠ¨ä½œå¯è§†åŒ–
â”‚   â”œâ”€â”€ data_convert.py     # CSVè½¬npzæ ¼å¼è½¬æ¢
â”‚   â””â”€â”€ ...
â”œâ”€â”€ usd/                     # æœºå™¨äººUSDèµ„äº§
â”‚   â”œâ”€â”€ g1_29dof_rev_1_0.usd
â”‚   â””â”€â”€ meshes/
â””â”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
```

---

## ğŸ¤– æ”¯æŒçš„Gymç¯å¢ƒ

| ç¯å¢ƒID | æœºå™¨äºº | ä»»åŠ¡ |
|--------|-------|------|
| `Isaac-G1-AMP-Walk-Direct-v0` | Unitree G1 | è¡Œèµ° |
| `Isaac-G1-AMP-Dance-Direct-v0` | Unitree G1 | èˆè¹ˆ |
| `Isaac-Humanoid-AMP-Walk-Direct-v0` | é€šç”¨äººå½¢ | è¡Œèµ° |
| `Isaac-Humanoid-AMP-Dance-Direct-v0` | é€šç”¨äººå½¢ | èˆè¹ˆ |
| `Isaac-Humanoid-AMP-Run-Direct-v0` | é€šç”¨äººå½¢ | è·‘æ­¥ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# 1. ç¡®ä¿å·²å®‰è£… Isaac Sim å’Œ Isaac Lab
# 2. ä»¥editableæ¨¡å¼å®‰è£…æ­¤é¡¹ç›®
pip install -e .

# 3. (å¯é€‰) åŒæ­¥skrlè„šæœ¬
bash ./sync_skrl_scripts.sh
```

### è®­ç»ƒ

```bash
# G1 è¡Œèµ°è®­ç»ƒ
python -m humanoid_amp.train --task Isaac-G1-AMP-Walk-Direct-v0 --headless --num_envs 4096

# G1 èˆè¹ˆè®­ç»ƒ
python -m humanoid_amp.train --task Isaac-G1-AMP-Dance-Direct-v0 --headless --num_envs 4096

# ä»checkpointæ¢å¤è®­ç»ƒ
python -m humanoid_amp.train --task Isaac-G1-AMP-Walk-Direct-v0 --checkpoint logs/skrl/<run>/checkpoints/Latest.ckpt
```

### è¯„ä¼°

```bash
python -m humanoid_amp.play --task Isaac-G1-AMP-Walk-Direct-v0 --num_envs 32 --checkpoint logs/skrl/<run>/checkpoints/Latest.ckpt
```

### TensorBoardç›‘æ§

```bash
python -m tensorboard.main --logdir logs/skrl/
# æµè§ˆå™¨è®¿é—® http://localhost:6006
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. ç¯å¢ƒç±» (`G1AmpEnv` / `HumanoidAmpEnv`)

ç»§æ‰¿è‡ª `DirectRLEnv`ï¼Œå®ç°AMPè®­ç»ƒæ‰€éœ€çš„æ ¸å¿ƒåŠŸèƒ½ï¼š

- **`_setup_scene()`**: åœºæ™¯åˆå§‹åŒ–ï¼Œåˆ›å»ºæœºå™¨äººå’Œåœ°é¢
- **`_get_observations()`**: ç­–ç•¥è§‚å¯Ÿç©ºé—´ï¼ˆå…³èŠ‚ä½ç½®/é€Ÿåº¦ã€æ ¹çŠ¶æ€ã€å…³é”®èº«ä½“ç‚¹ä½ç½®ï¼‰
- **`_get_rewards()`**: å¥–åŠ±è®¡ç®—ï¼ˆç»ˆæ­¢æƒ©ç½šã€åŠ¨ä½œL2ã€å…³èŠ‚é™åˆ¶ç­‰ï¼‰
- **`_reset_idx()`**: ç¯å¢ƒé‡ç½®é€»è¾‘ï¼Œæ”¯æŒå¤šç§é‡ç½®ç­–ç•¥
- **`collect_reference_motions()`**: ä¸ºAMPåˆ¤åˆ«å™¨é‡‡æ ·å‚è€ƒåŠ¨ä½œ

### 2. åŠ¨ä½œåŠ è½½å™¨ (`MotionLoader`)

åŠ è½½npzæ ¼å¼åŠ¨ä½œæ•°æ®ï¼Œæä¾›ï¼š
- æ—¶é—´é‡‡æ ·ä¸æ’å€¼ï¼ˆçº¿æ€§æ’å€¼ + å››å…ƒæ•°çƒé¢æ’å€¼ï¼‰
- DOFç´¢å¼•æ˜ å°„
- æ”¯æŒéšæœºé‡‡æ ·å’ŒæŒ‡å®šæ—¶åˆ»é‡‡æ ·

### 3. G1æœºå™¨äººé…ç½® (`G1_CFG`)

29è‡ªç”±åº¦é…ç½®ï¼š
- **è…¿éƒ¨**: 6ç»„éšå¼æ‰§è¡Œå™¨ï¼ˆé«‹å…³èŠ‚ã€è†å…³èŠ‚ã€è…°éƒ¨ï¼‰
- **è„šè¸**: 4ä¸ªå…³èŠ‚
- **æ‰‹è‡‚**: 14ä¸ªå…³èŠ‚ï¼ˆè‚©ã€è‚˜ã€è…•ï¼‰

---

## ğŸ“Š è§‚å¯Ÿç©ºé—´ä¸åŠ¨ä½œç©ºé—´

| ç©ºé—´ | ç»´åº¦ | æè¿° |
|------|-----|------|
| è§‚å¯Ÿç©ºé—´ | 101 | å…³èŠ‚çŠ¶æ€(29Ã—2) + æ ¹çŠ¶æ€(6+6) + å…³é”®ç‚¹(10Ã—3) |
| åŠ¨ä½œç©ºé—´ | 29 | å…³èŠ‚ä½ç½®ç›®æ ‡ |
| AMPè§‚å¯Ÿç©ºé—´ | 101 | ä¸ç­–ç•¥è§‚å¯Ÿç©ºé—´ç›¸åŒ |

---

## ğŸ“‚ åŠ¨ä½œæ•°æ®å¤„ç†å·¥å…·

| è„šæœ¬ | åŠŸèƒ½ |
|------|------|
| `motion_loader.py` | åŠ è½½npzåŠ¨ä½œæ•°æ®ï¼Œæä¾›é‡‡æ · |
| `motion_viewer.py` | 3Då¯è§†åŒ–æ’­æ”¾åŠ¨ä½œ |
| `data_convert.py` | CSVè½¬npzï¼Œå«æ’å€¼å’Œæ­£è¿åŠ¨å­¦ |
| `motion_replayer.py` | Isaac Simä¸­å›æ”¾åŠ¨ä½œ |
| `verify_motion.py` | éªŒè¯npzæ–‡ä»¶å†…å®¹ |
| `visualize_motion.py` | ç”ŸæˆHTMLå›¾è¡¨å¯è§†åŒ– |

---

## ğŸ“š æ•°æ®é›†æ¥æº

åŠ¨ä½œæ•°æ®æ¥è‡ªå¯¹ LAFAN1 æ•°æ®é›†çš„é‡å®šå‘å¤„ç†ï¼š
- å®˜æ–¹æ•°æ®é›† (å·²ä¸‹æ¶): [unitreerobotics/LAFAN1_Retargeting_Dataset](https://huggingface.co/datasets/unitreerobotics/LAFAN1_Retargeting_Dataset)
- é•œåƒ: [lvhaidong/LAFAN1_Retargeting_Dataset](https://huggingface.co/datasets/lvhaidong/LAFAN1_Retargeting_Dataset)
- AMASSæ•°æ®é›†: [ember-lab-berkeley/AMASS_Retargeted_for_G1](https://huggingface.co/datasets/ember-lab-berkeley/AMASS_Retargeted_for_G1)

---

## ğŸ“ ç›¸å…³èµ„æº

- [Demo - Walk (Bilibili)](https://www.bilibili.com/video/BV19cRvYhEL8/)
- [Demo - Dance (Bilibili)](https://www.bilibili.com/video/BV1vW36zEEG8/)
- [Demo - Dance (YouTube)](https://youtu.be/_ItIFkp-Xi4)
- [Documentation (DeepWiki)](https://deepwiki.com/linden713/humanoid_amp)

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2026-02-05*
